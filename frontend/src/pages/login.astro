---
import Layout from "../layouts/Layout.astro";
import { Button } from "../../@/components/ui/button";
import { Input } from "../../@/components/ui/input";
import { Label } from "../../@/components/ui/label";
import {
	Card,
	CardHeader,
	CardTitle,
	CardDescription,
	CardContent,
	CardFooter,
} from "../../@/components/ui/card";
---

<Layout title="Login - Werehaus">
	<div
		class="min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900"
	>
		<Card
			id="loginCard"
			class="w-full max-w-md opacity-0 scale-95 transition-all duration-300 ease-out"
		>
			<CardHeader>
				<CardTitle>Login</CardTitle>
				<CardDescription>
					Enter your credentials to access the warehouse management
					system
				</CardDescription>
			</CardHeader>
			<CardContent>
				<form id="loginForm">
					<div class="grid w-full items-center gap-4">
						<div class="flex flex-col space-y-1.5">
							<Label htmlFor="username">Username</Label>
							<Input
								id="username"
								name="username"
								placeholder="Enter your username"
							/>
						</div>
						<div class="flex flex-col space-y-1.5">
							<Label htmlFor="password">Password</Label>
							<Input
								id="password"
								name="password"
								type="password"
								placeholder="Enter your password"
							/>
						</div>
					</div>
				</form>
			</CardContent>
			<CardFooter>
				<Button type="submit" form="loginForm" class="w-full"
					>Log In</Button
				>
			</CardFooter>
		</Card>
	</div>
</Layout>

<script>
	import { loginUser } from "../lib/api";

	const loginCard = document.getElementById("loginCard");
	const loginForm = document.getElementById("loginForm") as HTMLFormElement;

	// Fade in the login card when the page loads
	window.addEventListener("load", () => {
		setTimeout(() => {
			loginCard.classList.remove("opacity-0", "scale-95");
		}, 100);
	});

	loginForm.addEventListener("submit", async (e) => {
		e.preventDefault();
		const formData = new FormData(loginForm);
		const credentials = {
			username: formData.get("username") as string,
			password: formData.get("password") as string,
		};

		try {
			const response = await loginUser(credentials);
			if (response.token) {
				window.location.href = "/dashboard";
			} else {
				alert("Login failed. Please check your credentials.");
			}
		} catch (error) {
			console.error("Login error:", error);
			alert("An error occurred during login. Please try again.");
		}
	});
</script>
