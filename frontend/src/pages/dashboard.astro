---
import Layout from "../layouts/Layout.astro";
import {
	Card,
	CardContent,
	CardHeader,
	CardTitle,
} from "../../@/components/ui/card";
import { Button } from "../../@/components/ui/button";
---

<Layout title="Warehouse Management Dashboard">
	<div class="container mx-auto py-10">
		<h1 class="text-3xl font-bold mb-6">Warehouse Management Dashboard</h1>
		<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
			<Card>
				<CardHeader>
					<CardTitle>Total Items</CardTitle>
				</CardHeader>
				<CardContent>
					<p class="text-3xl font-bold" id="totalItems">Loading...</p>
				</CardContent>
			</Card>
			<Card>
				<CardHeader>
					<CardTitle>Active Locations</CardTitle>
				</CardHeader>
				<CardContent>
					<p class="text-3xl font-bold" id="totalLocations">
						Loading...
					</p>
				</CardContent>
			</Card>
			<Card>
				<CardHeader>
					<CardTitle>Pending Issues</CardTitle>
				</CardHeader>
				<CardContent>
					<p class="text-3xl font-bold" id="pendingIssues">
						Loading...
					</p>
				</CardContent>
			</Card>
		</div>
		<div class="grid grid-cols-2 gap-6">
			<Card>
				<CardHeader>
					<CardTitle>Recent Activity</CardTitle>
				</CardHeader>
				<CardContent>
					<ul id="recentActivity" class="list-disc pl-5">
						<li>Loading...</li>
					</ul>
				</CardContent>
			</Card>
			<Card>
				<CardHeader>
					<CardTitle>Quick Actions</CardTitle>
				</CardHeader>
				<CardContent>
					<div class="flex flex-col space-y-2">
						<Button as="a" href="/items">Manage Inventory</Button>
						<Button as="a" href="/locations">View Locations</Button>
						<Button as="a" href="/issue">Report Issue</Button>
						<Button as="a" href="/reports">Generate Report</Button>
					</div>
				</CardContent>
			</Card>
		</div>
	</div>
</Layout>

<script>
	import { fetchItems, fetchLocations, fetchPendingIssues } from "../lib/api";

	async function updateDashboard() {
		try {
			const [items, locations, pendingIssues] = await Promise.all([
				fetchItems(),
				fetchLocations(),
				fetchPendingIssues(),
			]);

			document.getElementById("totalItems").textContent =
				items.length.toString();
			document.getElementById("totalLocations").textContent =
				locations.length.toString();
			document.getElementById("pendingIssues").textContent =
				pendingIssues.length.toString();

			// Update recent activity (this is a placeholder, you might want to create a new API endpoint for this)
			const recentActivity = document.getElementById("recentActivity");
			recentActivity.innerHTML = `
				<li>New item added: Widget X</li>
				<li>Location updated: Warehouse B</li>
				<li>Issue reported: Inventory discrepancy</li>
			`;
		} catch (error) {
			console.error("Error updating dashboard:", error);
		}
	}

	updateDashboard();
</script>
